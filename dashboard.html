<!DOCTYPE html>
<html lang="en" data-lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>TNB | Intelligent Finance Dashboard</title>
    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#06b6d4" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Syne:wght@700;800&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link rel="stylesheet" href="dashboard.css" />
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body class="dark-mode">

<!-- TOP NAVBAR: TWO ROWS
     Row 1: Hamburger + Logo | Theme + Lang + Notifications
     Row 2: +Add Button | Search Bar | Profile Avatar
-->
<header class="top-navbar" role="banner">

    <!-- ROW 1 -->
    <div class="navbar-row navbar-row-1">
        <div class="navbar-r1-left">
            <button class="hamburger-btn" id="hamburger-btn" onclick="toggleSidebar()" aria-label="Toggle menu" aria-expanded="false">
                <span></span><span></span><span></span>
            </button>
            <div class="app-logo-mark">
                <span class="logo-icon"><i class="fas fa-bolt"></i></span>
                <span class="logo-text">TNB</span>
            </div>
        </div>
        <div class="navbar-r1-right">
            <button id="theme-toggle" class="nav-icon-btn" aria-label="Toggle theme">
                <i class="fas fa-moon" id="theme-icon"></i>
            </button>
            <button id="lang-toggle" class="nav-icon-btn lang-btn" aria-label="Switch language">
                <span id="lang-label">EN</span>
            </button>
            <!-- NOTIFICATION BELL -->
            <div class="notif-wrapper">
                <button class="nav-icon-btn notif-btn" id="notif-btn" aria-label="Notifications" aria-haspopup="true" aria-expanded="false">
                    <i class="fas fa-bell"></i>
                    <span class="notif-badge" id="notif-badge" style="display:none">0</span>
                </button>
                <!-- Notification Dropdown Panel -->
                <div class="notif-dropdown" id="notif-dropdown" role="menu">
                    <div class="notif-panel-header">
                        <span class="notif-panel-title" data-i18n="notifications">Notifications</span>
                        <button class="notif-mark-all" id="notif-mark-all" onclick="markAllNotificationsRead()" data-i18n="mark_all_read">Mark all read</button>
                    </div>
                    <div class="notif-list" id="notif-list">
                        <div class="notif-empty" id="notif-empty">
                            <i class="fas fa-bell-slash"></i>
                            <p data-i18n="no_notifications">No notifications yet</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ROW 2 -->
    <div class="navbar-row navbar-row-2">
        <button class="add-entry-btn" onclick="showChoiceModal()" aria-label="Add transaction">
            <i class="fas fa-plus"></i>
            <span data-i18n="add_new">Add New</span>
        </button>
        <div class="navbar-search">
            <i class="fas fa-search search-icon"></i>
            <input type="search" id="search-input" placeholder="Search transactions..." data-i18n-ph="search_placeholder" autocomplete="off" />
        </div>
        <div class="profile-wrapper">
            <button class="profile-trigger" id="profile-btn" aria-haspopup="true" aria-expanded="false">
                <img id="user-avatar" src="https://ui-avatars.com/api/?name=User&background=06b6d4&color=fff&bold=true" alt="User" />
            </button>
            <div id="profile-dropdown" class="dropdown-card" role="menu">
                <div class="dropdown-info">
                    <img id="dropdown-avatar" src="https://ui-avatars.com/api/?name=User&background=06b6d4&color=fff&bold=true" alt="User" />
                    <div>
                        <strong id="user-display-name">User Name</strong>
                        <small id="user-display-email">user@email.com</small>
                    </div>
                </div>
                <div class="dropdown-divider"></div>
                <div class="dropdown-mini-stats">
                    <div class="dms-item">
                        <span class="dms-label" data-i18n="monthly_income">Income</span>
                        <span class="dms-val income-color" id="dm-income">$0</span>
                    </div>
                    <div class="dms-item">
                        <span class="dms-label" data-i18n="monthly_expense">Expense</span>
                        <span class="dms-val expense-color" id="dm-expense">$0</span>
                    </div>
                    <div class="dms-item">
                        <span class="dms-label" data-i18n="savings_rate">Savings</span>
                        <span class="dms-val" id="dm-savings">0%</span>
                    </div>
                    <div class="dms-item">
                        <span class="dms-label" data-i18n="transactions">Entries</span>
                        <span class="dms-val" id="dm-count">0</span>
                    </div>
                </div>
                <div class="dropdown-divider"></div>
                <button class="dropdown-item" onclick="navigateTo('settings')" role="menuitem">
                    <i class="fas fa-gear"></i>
                    <span data-i18n="settings">Settings</span>
                </button>
                <button class="dropdown-item logout-red" id="logout-confirm-btn" role="menuitem">
                    <i class="fas fa-arrow-right-from-bracket"></i>
                    <span data-i18n="logout">Logout</span>
                </button>
            </div>
        </div>
    </div>
</header>

<!-- Mobile search bar -->
<div class="mobile-search-bar" id="mobile-search-bar">
    <i class="fas fa-search"></i>
    <input type="search" id="mobile-search-input" placeholder="Search..." autocomplete="off" />
    <button class="msb-close" onclick="closeMobileSearch()"><i class="fas fa-xmark"></i></button>
</div>

<!-- 3-COLUMN LAYOUT -->
<div class="layout-wrapper">

    <!-- LEFT SIDEBAR -->
    <aside class="left-sidebar" id="left-sidebar" role="navigation">
        <button class="sidebar-close-btn" onclick="closeSidebar()" aria-label="Close sidebar">
            <i class="fas fa-xmark"></i>
        </button>
        <nav class="sidebar-nav">
            <button class="sidebar-link active" onclick="setActiveNav(this); navigateTo('dashboard'); closeSidebarOnMobile()">
                <span class="sidebar-icon"><i class="fas fa-house"></i></span>
                <span class="sidebar-label" data-i18n="nav_dashboard">Dashboard</span>
            </button>
            <button class="sidebar-link income-nav" id="sidebar-add-income" onclick="setActiveNav(this); openModal('income'); closeSidebarOnMobile()">
                <span class="sidebar-icon"><i class="fas fa-circle-plus"></i></span>
                <span class="sidebar-label" data-i18n="nav_add_income">Add Income</span>
            </button>
            <button class="sidebar-link expense-nav" id="sidebar-add-expense" onclick="setActiveNav(this); openModal('expense'); closeSidebarOnMobile()">
                <span class="sidebar-icon"><i class="fas fa-circle-minus"></i></span>
                <span class="sidebar-label" data-i18n="nav_add_expense">Add Expense</span>
            </button>
            <button class="sidebar-link" onclick="setActiveNav(this); navigateTo('history'); closeSidebarOnMobile()">
                <span class="sidebar-icon"><i class="fas fa-receipt"></i></span>
                <span class="sidebar-label" data-i18n="nav_transactions">Transactions</span>
            </button>
            <button class="sidebar-link" onclick="setActiveNav(this); navigateTo('reports'); closeSidebarOnMobile()">
                <span class="sidebar-icon"><i class="fas fa-chart-line"></i></span>
                <span class="sidebar-label" data-i18n="nav_reports">Reports</span>
            </button>
            <div class="sidebar-divider"></div>
            <button class="sidebar-link" onclick="setActiveNav(this); navigateTo('settings'); closeSidebarOnMobile()">
                <span class="sidebar-icon"><i class="fas fa-gear"></i></span>
                <span class="sidebar-label" data-i18n="nav_settings">Settings</span>
            </button>
        </nav>
        <div class="sidebar-categories">
            <p class="sidebar-section-title" data-i18n="quick_categories">Quick Categories</p>
            <button class="cat-pill variant-salary" onclick="catAction('income','Salary'); closeSidebarOnMobile()">
                <i class="fas fa-money-bill-trend-up"></i>
                <span data-i18n="cat_salary">Salary</span>
            </button>
            <button class="cat-pill variant-invest" onclick="catAction('income','Investment'); closeSidebarOnMobile()">
                <i class="fas fa-chart-line"></i>
                <span data-i18n="cat_investment">Invest</span>
            </button>
            <button class="cat-pill variant-food" onclick="catAction('expense','Food'); closeSidebarOnMobile()">
                <i class="fas fa-burger"></i>
                <span data-i18n="cat_food">Food</span>
            </button>
            <button class="cat-pill variant-health" onclick="catAction('expense','Health'); closeSidebarOnMobile()">
                <i class="fas fa-kit-medical"></i>
                <span data-i18n="cat_health">Health</span>
            </button>
            <button class="cat-pill variant-shop" onclick="catAction('expense','Shopping'); closeSidebarOnMobile()">
                <i class="fas fa-bag-shopping"></i>
                <span data-i18n="cat_shopping">Shop</span>
            </button>
        </div>
        <div class="sidebar-user-mini">
            <img id="sidebar-avatar" src="https://ui-avatars.com/api/?name=User&background=06b6d4&color=fff&bold=true" alt="User" />
            <div class="sidebar-user-info">
                <span id="sidebar-username">User</span>
                <small id="sidebar-useremail">user@email.com</small>
            </div>
        </div>
    </aside>

    <div class="sidebar-overlay" id="sidebar-overlay" onclick="closeSidebar()"></div>

    <!-- MAIN CONTENT -->
    <main class="main-content" id="main-content">
        <div class="page-greeting">
            <div>
                <h2 class="greeting-text" id="greeting-text">Good morning ðŸ‘‹</h2>
                <p class="greeting-sub" data-i18n="greeting_sub">Here's your financial overview</p>
            </div>
            <button class="nav-icon-btn mobile-search-trigger" id="mobile-search-trigger" aria-label="Search" style="display:none">
                <i class="fas fa-search"></i>
            </button>
        </div>

        <div class="summary-cards-row">
            <div class="summary-card balance-card">
                <div class="card-label">
                    <span class="card-icon-wrap balance-icon"><i class="fas fa-wallet"></i></span>
                    <span data-i18n="total_balance">Total Balance</span>
                </div>
                <h2 id="main-balance" class="card-amount">$0.00</h2>
                <p class="card-sub" data-i18n="available_funds">Available funds</p>
            </div>
            <div class="summary-card income-card">
                <div class="card-label">
                    <span class="card-icon-wrap income-icon"><i class="fas fa-arrow-trend-up"></i></span>
                    <span data-i18n="total_income">Total Income</span>
                </div>
                <h2 id="total-income" class="card-amount income-amt">+$0.00</h2>
                <p class="card-sub" data-i18n="this_period">This period</p>
            </div>
            <div class="summary-card expense-card">
                <div class="card-label">
                    <span class="card-icon-wrap expense-icon"><i class="fas fa-arrow-trend-down"></i></span>
                    <span data-i18n="total_expense">Total Expense</span>
                </div>
                <h2 id="total-expense" class="card-amount expense-amt">-$0.00</h2>
                <p class="card-sub" data-i18n="this_period">This period</p>
            </div>
        </div>

        <div class="feed-header">
            <h3 class="feed-title" data-i18n="recent_activity">Recent Activity</h3>
            <div class="feed-actions">
                <button class="feed-filter-btn active" onclick="filterFeed('all',this)" data-i18n="filter_all">All</button>
                <button class="feed-filter-btn" onclick="filterFeed('income',this)" data-i18n="filter_income">Income</button>
                <button class="feed-filter-btn" onclick="filterFeed('expense',this)" data-i18n="filter_expense">Expense</button>
            </div>
        </div>

        <div id="transaction-list" class="transaction-feed"></div>
    </main>

    <!-- RIGHT SIDEBAR -->
    <aside class="right-sidebar">
        <div class="right-card">
            <div class="right-card-header">
                <i class="fas fa-calendar-days"></i>
                <h4 data-i18n="monthly_summary">Monthly Summary</h4>
            </div>
            <div class="monthly-summary-bars">
                <div class="summary-bar-row">
                    <span data-i18n="income">Income</span>
                    <div class="bar-track"><div class="bar-fill income-bar" id="income-bar" style="width:0%"></div></div>
                    <span id="rs-income">$0</span>
                </div>
                <div class="summary-bar-row">
                    <span data-i18n="expense">Expense</span>
                    <div class="bar-track"><div class="bar-fill expense-bar" id="expense-bar" style="width:0%"></div></div>
                    <span id="rs-expense">$0</span>
                </div>
            </div>
            <div class="savings-rate-wrap">
                <span data-i18n="savings_rate">Savings Rate</span>
                <span class="savings-rate-val" id="savings-rate">0%</span>
            </div>
        </div>
        <div class="right-card">
            <div class="right-card-header">
                <i class="fas fa-chart-pie"></i>
                <h4 data-i18n="category_breakdown">Category Breakdown</h4>
            </div>
            <div id="category-breakdown" class="category-breakdown-list">
                <p class="rs-empty" data-i18n="no_data">No data yet</p>
            </div>
        </div>
        <div class="right-card">
            <div class="right-card-header">
                <i class="fas fa-bolt"></i>
                <h4 data-i18n="quick_stats">Quick Stats</h4>
            </div>
            <div class="stats-grid-small">
                <div class="stat-mini">
                    <span class="stat-mini-val" id="stat-count">0</span>
                    <span class="stat-mini-label" data-i18n="transactions">Transactions</span>
                </div>
                <div class="stat-mini">
                    <span class="stat-mini-val" id="stat-avg">$0</span>
                    <span class="stat-mini-label" data-i18n="avg_entry">Avg. Entry</span>
                </div>
                <div class="stat-mini">
                    <span class="stat-mini-val" id="stat-largest">$0</span>
                    <span class="stat-mini-label" data-i18n="largest_entry">Largest</span>
                </div>
                <div class="stat-mini">
                    <span class="stat-mini-val" id="stat-cats">0</span>
                    <span class="stat-mini-label" data-i18n="categories">Categories</span>
                </div>
            </div>
        </div>
        <div class="right-card quick-add-card">
            <div class="right-card-header">
                <i class="fas fa-plus"></i>
                <h4 data-i18n="quick_add">Quick Add</h4>
            </div>
            <div class="quick-add-btns">
                <button class="qa-btn income-qa" onclick="openModal('income')">
                    <i class="fas fa-circle-plus"></i>
                    <span data-i18n="nav_add_income">Add Income</span>
                </button>
                <button class="qa-btn expense-qa" onclick="openModal('expense')">
                    <i class="fas fa-circle-minus"></i>
                    <span data-i18n="nav_add_expense">Add Expense</span>
                </button>
            </div>
        </div>
    </aside>
</div>

<!-- MOBILE FAB -->
<div class="mobile-fab-wrap">
    <button class="fab-main" onclick="showChoiceModal()" aria-label="Add transaction">
        <i class="fas fa-plus"></i>
    </button>
</div>

<!-- MOBILE BOTTOM NAV -->
<nav class="bottom-bar" id="bottom-bar">
    <button class="nav-link active" onclick="navigateTo('dashboard'); setBottomNav(this)">
        <i class="fas fa-house"></i>
        <span data-i18n="nav_dashboard">Home</span>
    </button>
    <button class="nav-link" onclick="navigateTo('history'); setBottomNav(this)">
        <i class="fas fa-receipt"></i>
        <span data-i18n="nav_transactions">History</span>
    </button>
    <div class="fab-space"></div>
    <button class="nav-link" onclick="navigateTo('reports'); setBottomNav(this)">
        <i class="fas fa-chart-pie"></i>
        <span data-i18n="nav_reports">Stats</span>
    </button>
    <button class="nav-link" onclick="navigateTo('settings'); setBottomNav(this)">
        <i class="fas fa-gear"></i>
        <span data-i18n="nav_settings">Settings</span>
    </button>
</nav>

<!-- CHOICE MODAL -->
<div id="choice-modal" class="modal-overlay" role="dialog" aria-modal="true">
    <div class="modal-sheet animate-up">
        <div class="modal-handle"></div>
        <h3 data-i18n="new_entry">New Entry</h3>
        <p class="modal-subtitle" data-i18n="what_to_record">What would you like to record?</p>
        <div class="choice-grid">
            <button class="choice-card income-theme" onclick="selectChoice('income')">
                <div class="choice-icon"><i class="fas fa-circle-plus"></i></div>
                <span data-i18n="nav_add_income">Add Income</span>
                <small data-i18n="income_hint">Salary, Business, etc.</small>
            </button>
            <button class="choice-card expense-theme" onclick="selectChoice('expense')">
                <div class="choice-icon"><i class="fas fa-circle-minus"></i></div>
                <span data-i18n="nav_add_expense">Add Expense</span>
                <small data-i18n="expense_hint">Food, Rent, etc.</small>
            </button>
        </div>
        <button class="btn-cancel-modal" onclick="closeChoiceModal()" data-i18n="cancel">Cancel</button>
    </div>
</div>

<!-- TRANSACTION FORM MODAL (ALL FIELDS PRESERVED) -->
<div id="transaction-modal" class="modal-overlay" role="dialog" aria-modal="true">
    <div class="modal-card">
        <div class="modal-card-header" id="modal-header-bar">
            <span class="modal-type-badge" id="modal-type-badge">Income</span>
            <h3 id="modal-form-title" data-i18n="add_income">Add Income</h3>
            <button class="modal-close-btn" onclick="closeModal()" aria-label="Close">
                <i class="fas fa-xmark"></i>
            </button>
        </div>
        <form id="transaction-form" novalidate>
            <input type="hidden" id="trans-type" value="income" />
            <div class="input-field">
                <label for="amount" data-i18n="amount">Amount</label>
                <div class="amount-input-wrap">
                    <span class="currency-symbol">$</span>
                    <input type="number" id="amount" placeholder="0.00" step="0.01" min="0.01" required inputmode="decimal" />
                </div>
            </div>
            <div class="input-field">
                <label for="category" data-i18n="category">Category</label>
                <div class="select-wrap">
                    <select id="category" required></select>
                    <i class="fas fa-chevron-down select-arrow"></i>
                </div>
            </div>
            <div class="input-field">
                <label for="note" data-i18n="note">Note</label>
                <input type="text" id="note" placeholder="Add a description..." data-i18n-ph="note_placeholder" maxlength="120" />
            </div>
            <div class="modal-actions">
                <button type="submit" class="btn-confirm" id="save-btn">
                    <i class="fas fa-check"></i>
                    <span data-i18n="confirm">Confirm</span>
                </button>
                <button type="button" class="btn-back" onclick="closeModal()" data-i18n="cancel">Cancel</button>
            </div>
        </form>
    </div>
</div>

<!-- Toast -->
<div id="toast" class="toast" role="alert" aria-live="polite"></div>

<script src="dashboard.js"></script>
</body>
</html>
